<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pagou-Jogou VÃ´lei Clube</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #000000;
      --bg-secondary: #111111;
      --bg-card: #1a1a1a;
      --text-primary: #ffffff;
      --text-muted: #888888;
      --accent: #ff6b00;
      --accent-light: #ff8533;
      --accent-dark: #cc5500;
      --danger: #ef4444;
      --spacing-xs: 4px;
      --spacing-sm: 8px;
      --spacing-md: 16px;
      --spacing-lg: 24px;
      --spacing-xl: 32px;
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --sidebar-width: 240px;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Inter, system-ui, Arial, sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }
    
    /* LAYOUT */
    .app-container { display: flex; min-height: 100vh; }
    .sidebar { width: var(--sidebar-width); background: var(--bg-secondary); border-right: 1px solid rgba(255,255,255,0.05); padding: var(--spacing-lg); display: flex; flex-direction: column; position: fixed; height: 100vh; left: 0; top: 0; }
    .sidebar-logo { display: flex; align-items: baseline; gap: 4px; font-weight: 700; letter-spacing: 1px; font-size: 18px; margin-bottom: var(--spacing-xl); padding-bottom: var(--spacing-lg); border-bottom: 1px solid rgba(255,255,255,0.05); }
    .sidebar-logo .part1 { color: var(--text-primary); }
    .sidebar-logo .part2 { color: var(--accent); }
    .sidebar-nav { display: flex; flex-direction: column; gap: var(--spacing-sm); flex: 1; }
    .nav-item { display: flex; align-items: center; gap: var(--spacing-md); padding: 14px 16px; border-radius: var(--radius-md); color: var(--text-muted); text-decoration: none; font-size: 14px; font-weight: 500; transition: all 0.2s; cursor: pointer; border: none; background: transparent; width: 100%; text-align: left; }
    .nav-item:hover { background: rgba(255, 107, 0, 0.1); color: var(--text-primary); }
    .nav-item.active { background: rgba(255, 107, 0, 0.15); color: var(--accent); border-left: 3px solid var(--accent); }
    
    .main-content { flex: 1; margin-left: var(--sidebar-width); padding: var(--spacing-xl); min-height: 100vh; }
    .page { display: none; max-width: 800px; margin: 0 auto; }
    .page.active { display: block; }
    .page-header { margin-bottom: var(--spacing-xl); }
    .page-title { font-size: 28px; font-weight: 700; color: var(--text-primary); margin-bottom: var(--spacing-xs); }
    .page-subtitle { color: var(--text-muted); font-size: 14px; }
    
    /* CARDS & FORM */
    .card { background: var(--bg-card); border-radius: var(--radius-lg); padding: var(--spacing-lg); margin-bottom: var(--spacing-lg); border: 1px solid rgba(255,255,255,0.05); }
    .card-title { font-size: 16px; font-weight: 600; margin-bottom: var(--spacing-md); display: flex; align-items: center; gap: var(--spacing-sm); }
    .form-group { margin-bottom: var(--spacing-md); }
    .form-label { display: block; font-size: 13px; color: var(--text-muted); margin-bottom: var(--spacing-xs); }
    input, select { width: 100%; height: 48px; padding: 12px 14px; border-radius: var(--radius-md); border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.03); color: var(--text-primary); font-size: 15px; transition: border-color 0.2s; }
    input:focus, select:focus { outline: none; border-color: var(--accent); }
    
    /* BOTÃ•ES */
    .btn { height: 48px; padding: 12px 20px; border-radius: var(--radius-md); border: none; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; gap: var(--spacing-sm); }
    .btn-primary { background: linear-gradient(135deg, var(--accent), var(--accent-dark)); color: #000; }
    .btn-primary:hover { background: linear-gradient(135deg, var(--accent-light), var(--accent)); transform: translateY(-1px); }
    .btn-danger { background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.3); color: var(--danger); }
    .btn-danger:hover { background: rgba(239,68,68,0.25); }
    .btn-block { width: 100%; }
    
    /* LISTA CONFIRMADOS */
    .contador-badge { background: rgba(255,107,0,0.2); color: var(--accent); padding: 4px 10px; border-radius: var(--radius-sm); font-size: 13px; font-weight: 600; }
    .lista-confirmados { list-style: none; }
    .lista-item { display: flex; align-items: center; justify-content: space-between; padding: 14px 12px; border-bottom: 1px solid rgba(255,255,255,0.03); transition: background 0.2s; }
    .lista-item:hover { background: rgba(255,255,255,0.02); }
    .lista-item.avulso { border-left: 3px solid var(--accent); background: rgba(255,107,0,0.03); }
    .lista-item .info { display: flex; align-items: center; gap: var(--spacing-sm); flex-wrap: wrap; }
    .lista-item .nome { font-weight: 500; }
    .badge { display: inline-block; padding: 3px 8px; border-radius: var(--radius-sm); font-size: 11px; font-weight: 600; text-transform: uppercase; }
    .badge-mensalista { background: rgba(59,130,246,0.2); color: #60a5fa; }
    .badge-avulso { background: rgba(255,107,0,0.2); color: var(--accent); }
    .badge-masculino { background: rgba(59,130,246,0.15); color: #60a5fa; }
    .badge-feminino { background: rgba(236,100,155,0.15); color: #ff6b9d; }
    .btn-remove { padding: 8px 12px; background: rgba(239,68,68,0.15); border: 1px solid rgba(239,68,68,0.2); border-radius: var(--radius-sm); color: var(--danger); font-size: 12px; cursor: pointer; transition: all 0.2s; }
    .btn-remove:hover { background: rgba(239,68,68,0.25); }
    
    /* TIMES */
    .times-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--spacing-md); }
    .time-card { background: rgba(255,255,255,0.02); border-radius: var(--radius-md); padding: var(--spacing-md); border: 1px solid rgba(255,255,255,0.05); }
    .time-card h4 { color: var(--accent); font-size: 15px; margin-bottom: var(--spacing-sm); padding-bottom: var(--spacing-sm); border-bottom: 1px solid rgba(255,255,255,0.05); }
    .time-card ul { list-style: none; }
    .time-card li { font-size: 14px; padding: 6px 0; color: var(--text-muted); display: flex; align-items: center; gap: 8px; }
    
    .btn-whatsapp { background: rgba(37,211,102,0.15); border: 1px solid rgba(37,211,102,0.3); color: #25d366; }
    .btn-whatsapp:hover { background: rgba(37,211,102,0.25); }
    
    /* MENSAGEM */
    .mensagem { text-align: center; padding: var(--spacing-md); margin-bottom: var(--spacing-md); border-radius: var(--radius-md); font-size: 14px; min-height: 20px; }
    .mensagem.sucesso { background: rgba(52,211,153,0.1); color: #34d399; }
    .mensagem.erro { background: rgba(239,68,68,0.1); color: var(--danger); }
    
    /* RESPONSIVO */
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .main-content { margin-left: 0; padding: var(--spacing-md); }
      .times-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        <span class="part1">PAGOU</span>
        <span class="part2">JOGOU</span>
      </div>
      <nav class="sidebar-nav">
        <button class="nav-item active" data-page="confirmados">
          <span class="icon">ðŸ“‹</span>
          <span>Confirmados</span>
        </button>
        <button class="nav-item" data-page="sorteio">
          <span class="icon">ðŸŽ²</span>
          <span>Sorteio</span>
        </button>
      </nav>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
      <!-- PÃ¡gina Confirmados -->
      <section id="page-confirmados" class="page active">
        <div class="page-header">
          <h1 class="page-title">Lista de PresenÃ§a</h1>
          <p class="page-subtitle">Confirme sua presenÃ§a para o vÃ´lei!</p>
        </div>
        <div class="card">
          <h3 class="card-title">Nova ConfirmaÃ§Ã£o</h3>
          <form id="formConfirma">
            <div class="form-group">
              <label class="form-label">Nome</label>
              <input type="text" id="nome" placeholder="Digite seu nome" required>
            </div>
            <div class="form-group">
              <label class="form-label">GÃªnero</label>
              <select id="genero" required>
                <option value="">Selecione</option>
                <option value="masculino">Masculino</option>
                <option value="feminino">Feminino</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Tipo</label>
              <select id="tipo" required>
                <option value="">Selecione</option>
                <option value="mensalista">Mensalista</option>
                <option value="avulso">Avulso</option>
              </select>
            </div>
            <button class="btn btn-primary btn-block" type="submit">Confirmar PresenÃ§a</button>
          </form>
        </div>
        <div id="mensagem" class="mensagem"></div>
        <div class="card">
          <h3 class="card-title">Confirmados <span class="contador-badge" id="contadorConfirmados">0</span></h3>
          <button class="btn btn-danger" id="limparConfirmados" style="margin-bottom: 16px;">Limpar Lista</button>
          <ul class="lista-confirmados" id="listaConfirmados"></ul>
        </div>
      </section>
      
      <!-- PÃ¡gina Sorteio -->
      <section id="page-sorteio" class="page">
        <div class="page-header">
          <h1 class="page-title">Sorteio de Times</h1>
          <p class="page-subtitle">Distribua os jogadores em times equilibrados</p>
        </div>
        <div class="card">
          <h3 class="card-title">Realizar Sorteio</h3>
          <p style="color: var(--text-muted); margin-bottom: 16px; font-size: 14px;">
            O sorteio distribui automaticamente os jogadores em 4 times, equilibrando homens e mulheres.
          </p>
          <button class="btn btn-primary btn-block" id="sortearTimes">Sortear Times</button>
        </div>
        <div id="resultadoSorteio"></div>
      </section>
    </main>
  </div>

  <script>
    // === CÃ“DIGO COMPLETO FUNCIONAL ===
    
    // NavegaÃ§Ã£o
    const navItems = document.querySelectorAll('[data-page]');
    const pages = document.querySelectorAll('.page');
    function navigateTo(pageId) {
      pages.forEach(p => p.classList.remove('active'));
      document.getElementById(`page-${pageId}`).classList.add('active');
      navItems.forEach(item => item.classList.toggle('active', item.dataset.page === pageId));
    }
    navItems.forEach(item => item.addEventListener('click', () => navigateTo(item.dataset.page)));
    
    // Mensagem
    function mostrarMensagem(texto, tipo = '') {
      const el = document.getElementById('mensagem');
      el.textContent = texto;
      el.className = `mensagem ${tipo}`;
      setTimeout(() => { el.textContent = ''; el.className = 'mensagem'; }, 3000);
    }
    
    // Atualizar lista (CAP 24)
    async function atualizarLista() {
      try {
        const res = await fetch('/confirmados');
        const data = await res.json();
        let confirmed = Array.isArray(data) ? data.slice(0, 24) : (data.confirmed || []).slice(0, 24);
        
        const contador = document.getElementById('contadorConfirmados');
        if (contador) contador.textContent = confirmed.length;
        
        const ul = document.getElementById('listaConfirmados');
        if (ul) {
          ul.innerHTML = '';
          confirmed.forEach((c, i) => {
            const li = document.createElement('li');
            li.className = `lista-item ${c.tipo === 'avulso' ? 'avulso' : ''}`;
            const info = document.createElement('div');
            info.className = 'info';
            const nome = document.createElement('span');
            nome.className = 'nome';
            nome.textContent = `${i + 1}. ${c.nome}`;
            info.appendChild(nome);
            const tipoBadge = document.createElement('span');
            tipoBadge.className = `badge badge-${c.tipo}`;
            tipoBadge.textContent = c.tipo === 'mensalista' ? 'M' : 'A';
            tipoBadge.title = c.tipo;
            info.appendChild(tipoBadge);
            if (c.genero) {
              const generoBadge = document.createElement('span');
              generoBadge.className = `badge badge-${c.genero}`;
              generoBadge.textContent = c.genero === 'masculino' ? 'â™‚' : 'â™€';
              generoBadge.title = c.genero;
              info.appendChild(generoBadge);
            }
            li.appendChild(info);
            const btn = document.createElement('button');
            btn.className = 'btn-remove';
            btn.textContent = 'âœ•';
            btn.title = `Remover ${c.nome}`;
            btn.addEventListener('click', () => removerConfirmado(c.id));
            li.appendChild(btn);
            ul.appendChild(li);
          });
        }
      } catch (err) {
        console.error('Erro lista:', err);
        mostrarMensagem('Erro ao carregar lista.');
      }
    }
    
    // Remover confirmado
    async function removerConfirmado(id) {
      if (!confirm('Remover esta pessoa da lista?')) return;
      try {
        const res = await fetch(`/confirmados/${id}`, { method: 'DELETE' });
        const data = await res.json();
        if (data.sucesso) {
          mostrarMensagem('Removido com sucesso!', 'sucesso');
          atualizarLista();
        } else {
          mostrarMensagem(data.erro || 'Erro ao remover.', 'erro');
        }
      } catch (err) {
        mostrarMensagem('Erro de conexÃ£o.', 'erro');
      }
    }
    
    // Form confirmaÃ§Ã£o
    document.getElementById('formConfirma').addEventListener('submit', async function(e) {
      e.preventDefault();
      const nome = document.getElementById('nome').value.trim();
      const tipo = document.getElementById('tipo').value;
      const genero = document.getElementById('genero').value;
      if (!nome || !tipo || !genero) return mostrarMensagem('Preencha todos os campos.', 'erro');
      
      try {
        const res = await fetch('/confirmar', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nome, tipo, genero })
        });
        const data = await res.json();
        if (res.ok) {
          mostrarMensagem('PresenÃ§a confirmada!', 'sucesso');
          this.reset();
          atualizarLista();
        } else {
          throw new Error(data.erro || 'Erro ao confirmar.');
        }
      } catch (err) {
        mostrarMensagem(err.message || 'Erro ao confirmar.', 'erro');
      }
    });
    
    // SORTEIO PERFEITO (24 max, 4x6, sem vaga extra se 24)
    function sortearTimes(confirmados) {
      console.log('Sorteio iniciando com:', confirmados.length, 'confirmados');
      const MAX_JOGADORES = 24;
      const NUM_TIMES = 4;
      const MAX_POR_TIME = 6;
      
      let jogadores = confirmados.slice(0, MAX_JOGADORES);
      jogadores.forEach(c => c.genero ||= 'masculino');
      
      const homens = jogadores.filter(c => c.genero === 'masculino');
      const mulheres = jogadores.filter(c => c.genero === 'feminino');
      
      function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
      }
      shuffle([...homens]);
      shuffle([...mulheres]);
      
      // Intercala M-H
      const combinado = [];
      let mi = 0, hi = 0;
      while (mi < mulheres.length || hi < homens.length) {
        if (mi < mulheres.length) combinado.push(mulheres[mi++]);
        if (hi < homens.length) combinado.push(homens[hi++]);
      }
      
      // Round-robin perfeito
      const times = Array(NUM_TIMES).fill().map(() => []);
      combinado.forEach((jogador, idx) => {
        const timeIdx = idx % NUM_TIMES;
        if (times[timeIdx].length < MAX_POR_TIME) {
          times[timeIdx].push(jogador);
        }
      });
      
      // Vaga livre SOMENTE se <24
      if (confirmados.length < MAX_JOGADORES) {
        times.forEach(time => {
          while (time.length < MAX_POR_TIME) {
            time.push({ nome: 'Vaga Livre', genero: '', tipo: '' });
          }
        });
      }
      
      console.log('Times finais:', times.map(t => t.length));
      return times;
    }
    
    // BotÃ£o sortear
    document.getElementById('sortearTimes').addEventListener('click', async function(e) {
      e.preventDefault();
      try {
        const res = await fetch('/confirmados');
        const data = await res.json();
        const list = Array.isArray(data) ? data : (data.confirmed || []);
        const times = sortearTimes(list);
        
        let html = '<div class="times-grid">';
        times.forEach((time, i) => {
          html += `<div class="time-card"><h4>Time ${i + 1}</h4><ul>`;
          time.forEach(p => {
            const generoBadge = p.genero ? `<span class="badge badge-${p.genero}">${p.genero === 'masculino' ? 'â™‚' : 'â™€'}</span>` : '';
            html += `<li>${p.nome}${generoBadge}</li>`;
          });
          html += '</ul></div>';
        });
        html += '</div>';
        html += '<div style="margin-top:16px;color:#34d399;font-weight:bold;">VersÃ£o corrigida 16/01/2026 - 4x6 perfeitos!</div>';
        document.getElementById('resultadoSorteio').innerHTML = html;
      } catch (err) {
        console.error('Erro sorteio:', err);
        mostrarMensagem('Erro no sorteio.', 'erro');
      }
    });
    
    // Limpar lista
    document.getElementById('limparConfirmados').addEventListener('click', async function(e) {
      e.preventDefault();
      if (confirm('Limpar todos os confirmados?')) {
        try {
          const res = await fetch('/confirmados', { method: 'DELETE' });
          const data = await res.json();
          if (data.sucesso) {
            mostrarMensagem('Lista limpa!', 'sucesso');
            atualizarLista();
          } else {
            mostrarMensagem('Erro ao limpar.', 'erro');
          }
        } catch (err) {
          mostrarMensagem('Erro de conexÃ£o.', 'erro');
        }
      }
    });
    
    // Inicializa
    atualizarLista();
  </script>
</body>
</html>
